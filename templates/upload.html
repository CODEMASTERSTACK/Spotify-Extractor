<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Spotify Playlist Extractor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="../static/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
  <div class="container">
    <div class="glass-card text-center">
      <div class="spotify-logo">
        <svg viewBox="0 0 168 168" style="width: 64px; height: 64px; margin-bottom: 1rem;">
          <circle cx="84" cy="84" r="84" fill="#1db954" />
          <path
            d="M120.1 115.2c-1.7 2.8-5.3 3.7-8.1 2-22.2-13.6-50.2-16.7-83.2-9.2-3.2.7-6.4-1.3-7.1-4.5-.7-3.2 1.3-6.4 4.5-7.1 35.6-8 66.2-4.5 90.7 10.5 2.8 1.7 3.7 5.3 2 8.3zm11.5-23.6c-2.1 3.4-6.5 4.5-9.9 2.4-25.4-15.6-64.2-20.1-94.2-11.1-3.7 1-7.5-1-8.5-4.7-1-3.7 1-7.5 4.7-8.5 33.8-9.8 76.2-5 104.2 12.2 3.4 2.1 4.5 6.5 2.4 9.7zm12.7-26.2c-29.1-17.2-77.2-18.8-104.6-10.4-4.2 1.3-8.7-1-10-5.2-1.3-4.2 1-8.7 5.2-10 30.9-9.3 83.2-7.5 116.1 11.6 4 2.3 5.3 7.5 3 11.5-2.3 4-7.5 5.3-11.5 3z"
            fill="#fff" />
        </svg>
      </div>

      <h1>Playlist Extractor</h1>
      <p class="subtitle">Turn your screenshots into Spotify playlists instantly.</p>

      <form method="post" enctype="multipart/form-data" id="uploadForm">
        <label class="file-upload-wrapper" id="dropZone">
          <input type="file" name="images" accept="image/*" multiple required id="fileInput">
          <i class="fas fa-cloud-upload-alt upload-icon"></i>
          <span class="upload-text">Drag & Drop or Click to Upload</span>
          <small style="color: #666; margin-top: 8px;">Up to 10 screenshots supported</small>
        </label>

        <div id="fileList" style="margin-bottom: 20px; color: var(--spotify-text-gray); font-size: 0.9rem;"></div>

        <button class="btn btn-primary w-100" type="submit">
          <i class="fas fa-magic" style="margin-right: 8px;"></i> Extract Songs
        </button>
      </form>

      <div style="margin: 2rem 0; position: relative; opacity: 0.5;">
        <hr style="border: 0; border-top: 1px solid #fff;">
        <span
          style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: #282828; padding: 0 10px; color: #b3b3b3; font-size: 0.8rem;">OR</span>
      </div>

      <a href="/login" class="btn btn-outline w-100">
        <i class="fab fa-spotify" style="margin-right: 8px;"></i> Login with Spotify
      </a>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <h3>Extracting Magic...</h3>
    <p style="color: #b3b3b3;">This might take a few seconds</p>
  </div>

  <script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const form = document.getElementById('uploadForm');
    const loadingOverlay = document.getElementById('loadingOverlay');

    // Drag & Drop effects
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
      dropZone.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
      dropZone.classList.add('dragover');
    }

    function unhighlight(e) {
      dropZone.classList.remove('dragover');
    }

    dropZone.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      fileInput.files = files;
      updateFileList(files);
    }

    fileInput.addEventListener('change', function () {
      updateFileList(this.files);
    });

    function updateFileList(files) {
      if (files.length > 0) {
        const names = Array.from(files).map(f => f.name).join(', ');
        fileList.textContent = `Selected: ${names}`;
        fileList.style.color = '#1DB954';
      } else {
        fileList.textContent = '';
      }
    }

    form.addEventListener('submit', function () {
      loadingOverlay.classList.add('active');
    });
  </script>
</body>

</html>